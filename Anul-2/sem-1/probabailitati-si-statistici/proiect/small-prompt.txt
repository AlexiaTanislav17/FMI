# Setări inițiale
set.seed(123)  # Pentru reproductibilitate
n <- 10  # Numărul maxim de etape
lambda <- rep(1, n)  # Parametrii exponențiali pentru fiecare etapă
alpha <- seq(0.9, 0.5, length.out = n)  # Probabilități de a continua
Nsim <- 1000000  # Număr de simulări

# Funcție de simulare a timpului total T
gen_time <- function(n, lambda, alpha) {
  T_total <- 0
  for (i in 1:n) {
    T_total <- T_total + rexp(1, lambda[i])  # Timpul pentru etapa i
    if (runif(1) > alpha[i]) return(T_total)  # Oprire cu probabilitatea 1-alpha[i]
  }
  return(T_total)
}

# Simularea lui T
sim_T <- replicate(Nsim, gen_time(n, lambda, alpha))

# Aproximarea lui E(T)
E_T_sim <- mean(sim_T)
cat("Valoarea simulată pentru E(T):", E_T_sim, "\n")

# Reprezentarea grafică a valorilor obținute pentru T
hist(sim_T, breaks = 50, probability = TRUE, main = "Distribuția timpului total T", xlab = "Timp total", col = "blue")
lines(density(sim_T), col = "red")

# Calcul exact al E(T)
E_T_exact <- sum(1 / lambda * cumprod(alpha))
cat("Valoarea exactă a lui E(T):", E_T_exact, "\n")

# Probabilitatea de finalizare a activității
prob_fin <- mean(sim_T >= sum(1 / lambda))
cat("Probabilitatea ca activitatea să fie finalizată:", prob_fin, "\n")

# Probabilitatea ca T <= sigma
sigma <- 5
prob_T_leq_sigma <- mean(sim_T <= sigma)
cat("Probabilitatea ca T <=", sigma, "este:", prob_T_leq_sigma, "\n")

# Timpul minim și maxim pentru finalizarea activității
T_min <- min(sim_T)
T_max <- max(sim_T)
cat("Timp minim:", T_min, "Timp maxim:", T_max, "\n")

# Reprezentare grafică a timpilor de finalizare
plot(sim_T, pch = 20, col = rgb(0, 0, 1, 0.3), main = "Timpii de finalizare ai activității", xlab = "Simulare", ylab = "Timp total")

# Probabilitatea de oprire înainte de etapa k
k_vals <- 1:n
prob_oprire <- sapply(k_vals, function(k) mean(sapply(1:Nsim, function(i) {
  sum(rexp(k, lambda[1:k])) * (runif(1) > alpha[k])
}) == 1))

# Graficul probabilităților de oprire
plot(k_vals, prob_oprire, type = "b", col = "red", pch = 16, main = "Probabilitatea de oprire înainte de etapa k", xlab = "Etapa k", ylab = "Probabilitate")
